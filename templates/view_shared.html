{% extends 'base.html' %}
{% block title %}View Shared Dataset - {{ dataset.name }} - Epidemic Monitoring{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin="" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

<style>
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
</style>
{% endblock %}

{% block content %}
<div>
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-0">{{ dataset.name }}</h1>
      <p class="text-muted">Shared by {{ dataset.owner.username }}</p>
    </div>
    <div>
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left me-1"></i> Back to Dashboard
      </a>
    </div>
  </div>

  {% if dataset.description %}
  <div class="alert alert-info mb-4">
    <p class="mb-0">{{ dataset.description }}</p>
  </div>
  {% endif %}

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link tab-button active" data-tab="chart-view" type="button" role="tab">
            Chart View
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link tab-button" data-tab="map-view" type="button" role="tab">
            Map View
          </button>
        </li>
      </ul>

      <div class="tab-content active" id="chart-view">
        <div class="mb-4">
          <h2 class="h5 mb-3">Customize Chart</h2>
          <div class="row g-3">
            <div class="col-md-4">
              <label for="chart-type" class="form-label">Chart Type</label>
              <select id="chart-type" class="form-select">
                <option value="line">Line Chart</option>
                <option value="bar">Bar Chart</option>
                <option value="pie">Pie Chart</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="data-field" class="form-label">Data Field</label>
              <select id="data-field" class="form-select">
                <option value="cases">Cases</option>
                <option value="deaths">Deaths</option>
                <option value="recovered">Recovered</option>
                <option value="hospitalized">Hospitalized</option>
                <option value="tested">Tested</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="group-by" class="form-label">Group By</label>
              <select id="group-by" class="form-select">
                <option value="date">Date</option>
                <option value="location">Location</option>
              </select>
            </div>
          </div>
        </div>

        <div style="height: 400px;" class="position-relative">
          <canvas id="chart-container"></canvas>
        </div>
      </div>

      <div class="tab-content" id="map-view">
        <div class="mb-4">
          <h2 class="h5 mb-3">Map Settings</h2>
          <div class="row g-3">
            <div class="col-md-4">
              <label for="map-data-field" class="form-label">Data Field</label>
              <select id="map-data-field" class="form-select">
                <option value="cases">Cases</option>
                <option value="deaths">Deaths</option>
                <option value="recovered">Recovered</option>
                <option value="hospitalized">Hospitalized</option>
                <option value="tested">Tested</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="map-view-type" class="form-label">View Type</label>
              <select id="map-view-type" class="form-select">
                <option value="markers">Markers</option>
                <option value="heatmap">Heatmap</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="date-filter" class="form-label">Date Filter</label>
              <input type="date" id="date-filter" class="form-control">
            </div>
          </div>
        </div>

        <div id="map-container" class="mb-3" style="height: 400px;"></div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header bg-white">
      <h2 class="h5 mb-0">Raw Data</h2>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover" id="data-table">
          <thead class="table-light">
            <tr id="data-header"></tr>
          </thead>
          <tbody id="data-body"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const datasetId = {{ dataset.id }};
</script>
<script src="{{ url_for('static', filename='js/visualize.js') }}"></script>
{% endblock %}